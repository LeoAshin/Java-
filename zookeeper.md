# ZooKeeper 相关点

### ZooKeeper选举机制以及过程
- 首先zk是依据数据是否为最新来决定节点能力用zxid表示。在选举开始的时候，发起选举的节点首先会选举自己为leader用zxid和sid来标识自己。然后节点会将选票发送给其它节点同时接收其它节点的选票信息，并和自己的进行比较，如果对方zxid比自己的大，则进行改投。在这个过程中，同时会去判断是否有超过办事的节点认同某一节点是最新节点，如果有，则投票结束，该节点为新的leader节点。
在启动的时候，由于都是新的数据，zxid是一致的， 当A启动时给自己投票保持looking，当B启动时B给自己投一票，1和2都给自己投一票。这会后A发现Bid比自己大改投B，当前为A0票B2票，当3启动时，ABC都先给自己投一票发现C最大，改投C C这时候成为leader达到半数原则，C状态更改为leading，AB改成following，当D再加入进来的时候由于flowing状态AB不会更改选票，少数服从多数原则D改成flowing
- Zookeeper选举算法是基于FastLeaderElection
### 基于Zookeeper的分布式锁
- zookeeper 的分布式锁基于zookeeper的临时有序节点特性，当一个方法需要加锁的时候再zk中创建一个临时节点如果当前有序节点序号最小，则获取到锁进行执行

### zk如何保证主从节点的状态同步
基于zab协议，zab协议有两种模式
- 恢复模式， 当服务启动或者在leader崩溃之后，就进入了恢复模式，当leader被选举出来之后
### zk与redis分布式锁的区别

### zk的节点类型
- 持久化节点
- 临时节点